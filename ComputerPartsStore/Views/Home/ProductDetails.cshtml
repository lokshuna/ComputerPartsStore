@model ComputerPartsStore.Models.Accessories
@{
    ViewData["Title"] = Model.Accessory_Name;
}

<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Головна</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("Catalog", "Home")">Каталог</a></li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Catalog", "Home", new { categoryId = Model.Catalog_id })">
                    @Model.Catalog.Accessory_type
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">@Model.Accessory_Name</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-6">
            <!-- Product Image Placeholder -->
            <div class="card">
                <div class="card-body text-center p-5">
                    <div class="product-image-placeholder">
                        @switch (Model.Catalog.Accessory_type)
                        {
                            case "Процесори":
                                <i class="fas fa-microchip text-primary" style="font-size: 8rem;"></i>
                                break;
                            case "Відеокарти":
                                <i class="fas fa-tv text-success" style="font-size: 8rem;"></i>
                                break;
                            case "Оперативна пам'ять":
                                <i class="fas fa-memory text-info" style="font-size: 8rem;"></i>
                                break;
                            case "Материнські плати":
                                <i class="fas fa-project-diagram text-warning" style="font-size: 8rem;"></i>
                                break;
                            case "Блоки живлення":
                                <i class="fas fa-battery-full text-danger" style="font-size: 8rem;"></i>
                                break;
                            case "Накопичувачі":
                                <i class="fas fa-hdd text-secondary" style="font-size: 8rem;"></i>
                                break;
                            default:
                                <i class="fas fa-cube text-dark" style="font-size: 8rem;"></i>
                                break;
                        }
                    </div>
                    <p class="text-muted mt-3">Зображення товару</p>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="product-details">
                <!-- Product Title -->
                <h1 class="mb-3">@Model.Accessory_Name</h1>

                <!-- Category -->
                <div class="mb-3">
                    <span class="badge bg-secondary fs-6">@Model.Catalog.Accessory_type</span>
                </div>

                <!-- Price -->
                <div class="mb-4">
                    <h2 class="text-primary mb-2">@Model.Accessory_Price.ToString("N0") ₴</h2>
                    <p class="text-muted">Ціна за одиницю</p>
                </div>

                <!-- Availability -->
                <div class="mb-4">
                    <div class="d-flex align-items-center">
                        <span class="me-2">Наявність:</span>
                        <span class="badge bg-@(Model.Accessory_Availability == "В наявності" ? "success" : "danger") fs-6">
                            @Model.Accessory_Availability
                        </span>
                    </div>
                </div>

                <!-- Specifications -->
                <div class="mb-4">
                    <h5>Характеристики:</h5>
                    <p class="text-muted">@Model.Specifications</p>
                </div>

                <!-- Add to Cart Section -->
                @if (Model.Accessory_Availability == "В наявності")
                {
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-4">
                                    <label class="form-label">Кількість:</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="changeQuantity(-1)">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <input type="number" class="form-control text-center" id="quantity"
                                               value="1" min="1" max="10" onchange="validateQuantity()">
                                        <button class="btn btn-outline-secondary" type="button" onclick="changeQuantity(1)">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary btn-lg" onclick="addToCartWithQuantity()">
                                            <i class="fas fa-cart-plus me-2"></i>Додати до кошика
                                        </button>
                                        @if (User.Identity.IsAuthenticated)
                                        {
                                            <button class="btn btn-outline-primary" onclick="buyNow()">
                                                <i class="fas fa-bolt me-2"></i>Купити зараз
                                            </button>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Товар тимчасово відсутній на складі
                    </div>
                }

                <!-- Features -->
                <div class="row">
                    <div class="col-6">
                        <div class="text-center">
                            <i class="fas fa-shipping-fast text-primary mb-2" style="font-size: 2rem;"></i>
                            <h6>Швидка доставка</h6>
                            <small class="text-muted">1-3 дні</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <i class="fas fa-shield-alt text-success mb-2" style="font-size: 2rem;"></i>
                            <h6>Гарантія</h6>
                            <small class="text-muted">Офіційна</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <hr class="my-5">
    <div class="row">
        <div class="col-12">
            <h3 class="mb-4">Схожі товари</h3>
            <div id="related-products" class="row">
                <!-- Related products will be loaded here via AJAX -->
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Завантаження...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let currentQuantity = 1;

        function changeQuantity(delta) {
            const quantityInput = document.getElementById('quantity');
            const newQuantity = parseInt(quantityInput.value) + delta;

            if (newQuantity >= 1 && newQuantity <= 10) {
                quantityInput.value = newQuantity;
                currentQuantity = newQuantity;
            }
        }

        function validateQuantity() {
            const quantityInput = document.getElementById('quantity');
            let quantity = parseInt(quantityInput.value);

            if (isNaN(quantity) || quantity < 1) {
                quantity = 1;
            } else if (quantity > 10) {
                quantity = 10;
                showToast('Максимальна кількість товару - 10 штук', 'warning');
            }

            quantityInput.value = quantity;
            currentQuantity = quantity;
        }

        function addToCartWithQuantity() {
            const quantity = document.getElementById('quantity').value;
            addToCart(@Model.Accessory_id, parseInt(quantity));
        }

        function buyNow() {
            const quantity = document.getElementById('quantity').value;

            // Add to cart first
            $.ajax({
                url: '/Cart/AddToCart',
                type: 'POST',
                data: {
                    productId: @Model.Accessory_id,
                    quantity: parseInt(quantity)
                },
                success: function(response) {
                    if (response.success) {
                        // Redirect to checkout
                        window.location.href = '/Cart/Checkout';
                    } else {
                        showToast(response.message, 'error');
                    }
                },
                error: function() {
                    showToast('Помилка при додаванні товару до кошика', 'error');
                }
            });
        }

        // Load related products
        $(document).ready(function() {
            loadRelatedProducts();
        });

        function loadRelatedProducts() {
            $.get('/Home/Catalog', {
                categoryId: @Model.Catalog_id
            }, function(data) {
                // Extract product cards from the response
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const productCards = doc.querySelectorAll('.product-card');

                let relatedHtml = '';
                let count = 0;

                productCards.forEach(function(card) {
                    if (count < 4) { // Show only 4 related products
                        const productId = card.querySelector('button[onclick*="addToCart"]');
                        if (productId && !productId.getAttribute('onclick').includes('@Model.Accessory_id')) {
                            relatedHtml += '<div class="col-lg-3 col-md-6 mb-4">' + card.outerHTML + '</div>';
                            count++;
                        }
                    }
                });

                if (relatedHtml) {
                    document.getElementById('related-products').innerHTML = relatedHtml;
                } else {
                    document.getElementById('related-products').innerHTML =
                        '<div class="col-12 text-center py-4"><p class="text-muted">Схожих товарів не знайдено</p></div>';
                }
            }).fail(function() {
                document.getElementById('related-products').innerHTML =
                    '<div class="col-12 text-center py-4"><p class="text-muted">Помилка завантаження схожих товарів</p></div>';
            });
        }
    </script>
}

<style>
    .product-image-placeholder {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 8px;
        padding: 2rem;
        transition: all 0.3s ease;
    }

        .product-image-placeholder:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: scale(1.02);
        }

    .product-details h1 {
        font-weight: 600;
        color: #2c3e50;
    }

    .breadcrumb {
        background: transparent;
        padding: 0;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: "›";
        color: #6c757d;
    }

    .input-group .btn {
        border-color: #ced4da;
    }

    .input-group .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    }



    {
        margin-bottom: 2rem;
    }

    .product-details h1 {
        font-size: 1.5rem;
    }

    }
</style>